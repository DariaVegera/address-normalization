# Address_matching_GPB
Проект "Матчинг адресов" студентов 1-го курса Магистратуры ИТМО

**Тема**: Разработка алгоритмов сопоставления адресов при помощи машинного обучения\
**Ответственный за проект**: Кристина Желтова @masterkristall\
**Участники**: Дарья Вегера @VegeraDA, Александр Демьянов @AlexDemone
#
# План
### Блок 1
- Изучение теоретических аспектов нормализации, разбора адресов на компоненты и алгоритмов информационного поиска/матчинга
- Проектирование пайплайна обработки адресов
- Выбор метрик для оценки качества сопоставления

### Блок 2
- Сбор примеров адресов из открытых источников или генерация синтетических данных
- Создание набора зашумленных адресов с типичными ошибками (опечатки, сокращения, различный порядок компонентов)
- Подготовка эталонного набора нормализованных адресов для обучения

### Блок 3
- Разработка модуля нормализации 
 Реализация алгоритмов сопоставления
- Тестирование и валидация подходов

# Code
Код представлен в виде последовательных сегментов:
1. в начале загружаем необходимые библиотеки и зависимости
2. затем создаем/выгружаем корпус с эталонными адресами (на которые будем равняться)
3. после создаем механизм для зашумления данных - чтобы протестировать эталонные адреса
4. далее создаем саму модель, которая будет проверять входящие адреса на соответствие эталонным
5. в конце при помощи метрик смотрим на результаты

## Финальная реализация
# Отчёт по прототипу матчинга адресов

## 1. Цель работы

**Задача:**  
Сопоставление “грязных” адресов (с опечатками, разным форматированием и сокращениями) с эталонным адресным справочником.

**Цель прототипа:**  
Проверить, насколько классический IR-подход способен:
- устойчиво работать с шумами,
- масштабироваться на тысячи адресов,
- давать управляемое качество через confidence-score.

---

## 2. Источник данных

| Компонент | Описание |
|----------|----------|
| Reference corpus | Адреса зданий из OpenStreetMap |
| География | Москва, Санкт-Петербург (несколько районов) |
| Формирование адреса | `улица + дом + город` |
| Кеширование | `reference_osm.csv` |
| Размер корпуса | **6 448 адресов** |

---

## 3. Нормализация адресов

Перед сравнением все адреса приводятся к единому виду.

**Основные шаги:**
- приведение к нижнему регистру
- замена `ё → е`
- удаление пунктуации
- унификация сокращений

**Примеры:**

| Исходный текст | После нормализации |
|----------------|-------------------|
| `Невский пр-т, д. 5` | `невский проспект дом 5` |
| `ул. Ленина, 10к2` | `улица ленина дом 10 корпус 2` |

---

## 4. Алгоритм матчинга

Используется **двухэтапный подход**: retrieval + rerank.

### Этап 1. Retrieval

| Параметр | Значение |
|---------|----------|
| Модель | TF-IDF |
| Признаки | символьные n-граммы |
| Диапазон n-грамм | 2–4 |
| Метрика | косинусное сходство |
| Результат | top-K кандидатов |

---

### Этап 2. Rerank

| Компонент | Назначение |
|-----------|------------|
| RapidFuzz | устойчивость к опечаткам |
| token_sort_ratio | устойчивость к перестановке слов |
| Итоговый скор | взвешенная сумма |

**Формула итогового скора:**
```text
final_score = 0.6 · cosine_similarity + 0.4 · fuzzy_score
```

## 5. Генерация шумов (тестирование)

Для оценки устойчивости используются синтетические искажения входных адресов.

| Тип шума       | Описание                   |
| -------------- | -------------------------- |
| Keyboard noise | ошибки соседних клавиш     |
| Random insert  | вставка случайных символов |
| Размер теста   | 100 адресов                |

Пример зашумленного запроса:
- Невский проспе4и, 5, Санкт - Петербург

## 6. Метрики качества
Accuracy@1
| Метрика             | Значение |
| ------------------- | -------- |
| Accuracy@1          | **0.96** |
| Количество запросов | 100      |

В 96% случаев правильный адрес находится на первом месте.

**Threshold-анализ (Auto-match)**
| Threshold | Precision | Recall | Coverage |
| --------- | --------- | ------ | -------- |
| 0.70      | 0.969     | 0.940  | 0.970    |
| 0.75      | 0.968     | 0.900  | 0.930    |
| 0.80      | 0.977     | 0.840  | 0.860    |
| 0.85      | 0.973     | 0.730  | 0.750    |
| 0.90      | 0.967     | 0.590  | 0.610    |

## 7. Интерпретация результатов
| Threshold | Интерпретация                      |
| --------- | ---------------------------------- |
| ≥ 0.85    | ~97% точность, ~75% авто-обработки |
| ≥ 0.80    | баланс точности и покрытия         |
| ≥ 0.70    | максимальное покрытие              |

## 8. Ограничения прототипа
- тест проводится на адресах, присутствующих в reference corpus
- не рассматриваются случаи отсутствия адреса в базе
- адрес представлен в упрощённом виде (без квартир, этажей)

## 9. Вывод
Прототип демонстрирует:
- высокую устойчивость к опечаткам
- хорошее качество автоматического матчинга
- управляемый trade-off между точностью и покрытием

Решение может использоваться как baseline и основа для дальнейшего развития:
- обучаемый ранкер
- компонентная валидация адреса

# References
- Colab - https://colab.research.google.com/drive/1H9_Lrog6tHvKCMze4UjLd4nidOTIaHZv?usp=sharing
