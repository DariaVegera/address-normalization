"""
Нормализация:
- нижний регистр
- ё->е
- общие сокращения (ул/пр-т/д/корп/стр/кв...)
- убираем пунктуацию
- сокращаем пробелы
"""

from __future__ import annotations

import re
from typing import Dict


_ABBREV: Dict[str, str] = {
    # типы улиц
    "ул": "улица",
    "ул.": "улица",
    "улиц": "улица",
    "пр": "проспект",
    "пр.": "проспект",
    "пр-т": "проспект",
    "просп": "проспект",
    "просп.": "проспект",
    "пер": "переулок",
    "пер.": "переулок",
    "ш": "шоссе",
    "ш.": "шоссе",
    "наб": "набережная",
    "наб.": "набережная",
    "пл": "площадь",
    "пл.": "площадь",
    # строения
    "д": "дом",
    "д.": "дом",
    "дом.": "дом",
    "корп": "корпус",
    "корп.": "корпус",
    "к": "корпус",
    "к.": "корпус",
    "стр": "строение",
    "стр.": "строение",
    "кв": "квартира",
    "кв.": "квартира",
    # виды городов
    "г": "город",
    "г.": "город",
    "пос": "поселок",
    "пос.": "поселок",
}


_PUNCT_RE = re.compile(r"[\.,;:!\?\(\)\[\]{}\"'`~@#$%^&*_+=<>|/\\-]+")
_WS_RE = re.compile(r"\s+")


def normalize_ru_address(text: str) -> str:
    """Сама функция
    """
    if text is None:
        return ""

    s = str(text).strip().lower()
    if not s:
        return ""

    # ё -> е
    s = s.replace("ё", "е")

    # обработка разделителей
    s = _PUNCT_RE.sub(" ", s)

    # нормализуем сокращения по токенам
    tokens = [t for t in _WS_RE.split(s) if t]
    tokens = [_ABBREV.get(t, t) for t in tokens]

    s = " ".join(tokens)
    s = _WS_RE.sub(" ", s).strip()
    return s
